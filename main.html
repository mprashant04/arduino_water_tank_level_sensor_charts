<html>
  <head>
  <title>Water Tank Level Sensor</title>

<style type="text/css">
  body { background-color: #ffffff; }
  #container { height: 100%; width: 100%; display: table; }
  #inner { vertical-align: middle; display: table-cell; }
  #gauge_div { width: 120px; margin: 0 auto; }
</style>

<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.2/howler.core.min.js"></script>

<script>

enableAutoRefresh =  getParameterByName('auto_refresh');
if (enableAutoRefresh != 1 && enableAutoRefresh != 0) enableAutoRefresh = 0;

lastSamples= 200;
lastEntryId = -1;
script_version = "v2.3"
basicMode =  (getParameterByName('advanced_mode') != '1') ;

//https://www.norwegiancreations.com/2015/10/tutorial-potentiometers-with-arduino-and-filtering/
EMA_a = 0.15;      //between 0 and 1, lower the number, higher the samples used for averaging, i.e. slower averaging



 // Add a helper to format timestamp data
Date.prototype.formatMMDDYYYY = function() {
	return (this.getMonth() + 1) +
	"/" +  this.getDate() +
	"/" +  this.getFullYear() ;
}

Date.prototype.formatMMDDYYYYHHMMSS = function() {
	return pad((this.getMonth() + 1),2) +
	"/" +  pad(this.getDate(),2) +
	"/" +  pad(this.getFullYear(),4) +
	" " +  pad(this.getHours(),2)  +
	":" +  pad(this.getMinutes(),2) +
	":" +  pad(this.getSeconds(),2)
	;
}

Date.prototype.formatHHMM = function() {
	return this.getHours() + ":" +  pad(this.getMinutes(),2);
}

Date.prototype.formatHHMMSS = function() {
	return this.getHours() + ":" +  pad(this.getMinutes(),2) + ":" +  pad(this.getSeconds(),2);
}

function pad(num, size) {
    num = num.toString();
    while (num.length < size) num = "0" + num;
    return num;
}
function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

function beep() {
	//not working consistently looks like
	//var sound;
	//sound = new Howl({
	//  src: ['data:audio/mpeg;base64,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']
	//});
	//sound.play();
};
function buildChartConfig(chartLabel, lineColor, pointColor, data, yMin, yMax, pointRadius, linewidth){
	  return {
        type:    'line',
        data:    {
            datasets: [
                {
                    label: chartLabel,                    
					data: data,
                    fill: false,
                    borderColor: lineColor,
					borderDash: [3, 3],
					borderWidth: linewidth,
					backgroundColor: pointColor,
					pointBackgroundColor: pointColor,
					pointBorderColor: pointColor,
					pointHoverBackgroundColor: pointColor,
					pointHoverBorderColor: pointColor,
					pointRadius: pointRadius,					
					pointHitRadius: pointRadius,					
                }            
			]
        },
        options: {
            responsive: true,
            title:      {
                display: true,
                text:    chartLabel
            },
			legend: {
				display: false
			},
			layout: {
				padding: {
					right: 25
				}
			},
            scales:     {
                xAxes: [{
                    type:       "time",
                    time:       {
                        parser: 'MM/DD/YYYY HH:mm:ss',
                        tooltipFormat: 'HH:mm:ss',
						unit: 'hour',
						displayFormats: {
						   //'millisecond': 'HH:mm',
						   //'second': 'HH:mm',
						   //'minute': 'HH:mm',
						   'hour': 'HH:mm',    //used for minor time tick
						   'day': 'DD MMM',		//used for major time tick
						   //'week': 'DD MMM HH:mm',
						   //'month': 'DD MMM HH:mm',
						   //'quarter': 'DD MMM HH:mm',
						   //'year': 'DD MMM HH:mm',
						}
                    },
					ticks: {
						 //maxTicksLimit: 20,
						 major: {
						   enabled: true, 
						   unit: 'day',
						   //unitStepSize: 1,
						   fontStyle: 'bold', 
						   fontSize: 14, 
						   fontColor: '#00264d',						   
						},
					}
                }],
                yAxes: [{
                    ticks: {						
						min: yMin,
						//steps: 2,
						//stepValue: 5,
						max: yMax
                    }
                }]
            },
			tooltips: {
				mode: 'x-axis',
				displayColors: false,
				callbacks: {
					label: function(tooltipItem, data) {
						return tooltipItem.yLabel ;
					},
					//title: function(tooltipItem, data) {
					//	return "";
					//}
				}
			},			
        }
    }
}




  function drawLineChart(chartLabel, fieldNumber, canvasId,  lineColor, pointColor, pointRadius, linewidth, elementIdLastEntryValue,elementIdLastEntryDate ) {

   
    var jsonData = $.ajax({
      url: 'https://api.thingspeak.com/channels/1440877/fields/' + fieldNumber + '.json?results=' + getParameterByName('samples'),
      dataType: 'json',
    }).done(function (results) {
			  
		  EMA_S = -1;       
	  
		  yMin = 99999999;
		  yMax = -999999;
		  
		  var data=[];
		  results["feeds"].forEach(function(packet) {
			
			val = { x:null, y:null};
			val.x = new Date(packet.created_at).formatMMDDYYYYHHMMSS();
			val.y = parseFloat(packet["field"  + fieldNumber]);
			
			if (yMin > val.y)  yMin = val.y;
			if (yMax < val.y)  yMax = val.y;			
					
			
			data.push (val);

			//console.log(val);
		  });
	  

		  var ctx = document.getElementById(canvasId).getContext("2d");
		  new Chart(ctx, buildChartConfig(chartLabel, lineColor, pointColor, data,yMin, yMax, pointRadius, linewidth));
		  
		  if (elementIdLastEntryValue)
			document.getElementById(elementIdLastEntryValue).innerHTML =  data[data.length-1].y;		
		  if (elementIdLastEntryDate)
			document.getElementById(elementIdLastEntryDate).innerHTML =  data[data.length-1].x;		
		  
		  
		});
}

	
		
	function displayCharts(){
		if (basicMode){
			drawLineChart("           ", 				"4", "lineChartPercentEMA_basic", 			"#ffffff","#804000", 2,0, "LevelPercentageValue_basic", "LevelPercentageDate_basic");		
		}
		else{
			drawLineChart("Signal", 					"1", "lineChartSignal", 				"#0080ff","#6666ff", 2,1);				
			drawLineChart("Signal EMA", 				"3", "lineChartSignalEMA", 				"#0080ff","#6666ff", 2,1);		
			drawLineChart("Level %", 					"2", "lineChartPercent", 				"#99cc00","#33cc00", 2,1);				
			drawLineChart("Level % EMA", 				"4", "lineChartPercentEMA", 			"#99cc00","#33cc00", 2,1);		
			
			drawLineChart("Uptime", 					"5", "lineChartUptime", 				"#00cccc","#006666", 2,1);
			drawLineChart("API Call Failures",			"6", "lineChartApiCallFailures", 		"#b366ff","#8000ff", 2,1);
			drawLineChart("Signal Threshold Jumps (Small)",		"7", "lineChartSignalThresholdJumpsSmall",	"#ff8566","#ff3300", 2,1);
			drawLineChart("Signal Threshold Jumps (Big)",		"8", "lineChartSignalThresholdJumpsBig",	"#ff8566","#ff3300", 2,1);
			
			
			document.getElementById('info').innerHTML = new Date().formatHHMMSS() + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  (" + script_version + ")";
			document.getElementById('infoSamples').innerHTML =  getParameterByName('samples');		
		}
	}
	
	function reloadPageIfDataChanged(){
		var jsonData = $.ajax({
			  url: 'https://api.thingspeak.com/channels/1440877/fields/1.json?results=1',
			  dataType: 'json',
			}).done(function (results) {

			entryId = results["feeds"][0]["entry_id"];
			if (lastEntryId > 0 && lastEntryId != entryId && enableAutoRefresh == 1){				
				beep();				
				window.location.reload();
			}
			else{				
				lastEntryId = entryId;
			}
		 });
	}
	
	function redirect(samples){
		if (samples == undefined){
			var sel = document.getElementById("mySelect");
			samples = sel.options[sel.selectedIndex].text;			
			
			if (isNaN(samples))  samples = getParameterByName('samples');
		}
		if (isNaN(samples))  samples = 200;

		var path = location.protocol + '//' + location.host + location.pathname;
		//alert (path);		
		window.location.replace(path + '?samples=' + (basicMode ? 5000 : samples )
									+ "&auto_refresh=" + (basicMode ? 1 : enableAutoRefresh )
									+ "&advanced_mode=" + (basicMode ? "0" : "1")
									+ "&time=" + new Date().formatMMDDYYYYHHMMSS ());
	}
	
	function enableRefresh(enable){
	      enableAutoRefresh = enable;	    
		  redirect();  	      
	}
  
	
	
	if (getParameterByName('samples') == null){		
		redirect (200);
	}
	
	function changeToAdvancedMode(advanced){
		basicMode = !advanced;
		redirect();
	}
	
	setInterval(reloadPageIfDataChanged, 3000);
	
	window.onload = function() {
		if (basicMode)
			document.getElementById("advanced_div").style.visibility = "hidden";
		else
			document.getElementById("basic_div").style.visibility = "hidden";
		
		displayCharts();	
		reloadPageIfDataChanged();	

		if (enableAutoRefresh == 1)
			document.getElementById("auto_refresh_off").style.display = "none";
		else
			document.getElementById("auto_refresh_on").style.display = "none";
	};
	
 
</script>

  </head>
     <style type="text/css">
			/**** for preventing scrollbars ******/
			#container{
				width: 100%;
				height: 100%;
				overflow: hidden;
				position: relative;
			}

			#inner{
				position: absolute;
				top: 0;
				bottom: 0;
				left: 0;
				right: -20px; /* Increase/Decrease this value for cross-browser compatibility */
				overflow-y: scroll;
			}
			.basic h1 {
			  font-family: 'Raleway', sans-serif;
			  font-weight: normal;
			  font-size: 160px;
			  text-align: center;
			  margin: 0
			}
			.basic  h2 {
			  font-family: 'Raleway', sans-serif;
			  font-weight: normal;
			  font-size: 50px;
			  text-align: center;
			  margin: 0
			}
    </style>
	
  <body>
    <div id="container">
      <div id="inner">	
	  
		<div id="basic_div" class="basic">	
			<h1 id="LevelPercentageValue_basic"></h1>
			<h2 id="LevelPercentageDate_basic"></h2>      								
			
			<br>			
			<canvas  id="lineChartPercentEMA_basic"  width="300" height="120"  style="border:1px solid black"></canvas>	  
			<label onclick="changeToAdvancedMode(true)"> .. </label>
		</div>
		
		<div id="advanced_div">			
			<button onclick="changeToAdvancedMode(false)"> basic </button>
				

				<table style=" width: 100%;">
					<tr>
						<td style="text-align:left">
							<div align = "left">	
								<select  id="mySelect" onchange="redirect()">
										<option>Samples</option>
										<option>10</option>
										<option>50</option>
										<option>100</option>
										<option>200</option>
										<option>300</option>
										<option>400</option>
										<option>500</option>
										<option>750</option>
										<option>1000</option>				
										<option>2000</option>				
										<option>3000</option>				
										<option>4000</option>				
										<option>5000</option>				
										<option>7500</option>				
										<option>10000</option>				
										<option>15000</option>				
								  </select>		  
								  <label id="infoSamples"/></label>	  
						  </div>	
						</td>
						<td style="text-align:right">
							<div>		
								
								<label id="auto_refresh_off" onclick="enableRefresh(1)"><font color="red" size="+1"  >&#128472;</font></label>	  													
								<label id="auto_refresh_on"  onclick="enableRefresh(0)"><font color="green" size="+1">&#128472;</font></label>	  	  
								
								<label id="info"/></label>	  
							</div>	
						</td>
					</tr>
				</table>  	  
				
					
				
			  
			  <canvas  id="lineChartSignal"  width="300" height="55"  style="border:1px solid black"></canvas>
			  <canvas  id="lineChartSignalEMA"  width="300" height="55"  style="border:1px solid black"></canvas>
			  <canvas  id="lineChartPercent"  width="300" height="55"  style="border:1px solid black"></canvas>	  
			  <canvas  id="lineChartPercentEMA"  width="300" height="55"  style="border:1px solid black"></canvas>	  
			  <canvas  id="lineChartApiCallFailures"  width="300" height="55"  style="border:1px solid black"></canvas>	  
			  <canvas  id="lineChartSignalThresholdJumpsSmall"  width="300" height="55"  style="border:1px solid black"></canvas>	  
			  <canvas  id="lineChartSignalThresholdJumpsBig"  width="300" height="55"  style="border:1px solid black"></canvas>	  
			  <canvas  id="lineChartUptime"  width="300" height="55"  style="border:1px solid black"></canvas>	  
		</div>			
	 
      </div>
	</div>
  </body>
</html>
